<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Analytics Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body{
  background:#f5f7fb;
  font-family:system-ui;
}
.card{
  border:none;
  border-radius:16px;
}
.chart-box{
  height:320px;
}
</style>
</head>

<body>
<div class="container py-5">

<div class="text-center mb-5">
  <h1 class="fw-bold">Cloud Analytics Dashboard</h1>
  <p class="text-muted">Aslan Daiyrov (70086) — Cloud Technologies Project</p>
</div>

<div class="row g-4 mb-5">
  <div class="col-md-3">
    <div class="card shadow-sm p-3 text-center">
      <small>Total Sales</small>
      <h4>210</h4>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm p-3 text-center">
      <small>Total Users</small>
      <h4>200</h4>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm p-3 text-center">
      <small>Traffic Sources</small>
      <h4>5</h4>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm p-3 text-center">
      <small>Product Categories</small>
      <h4>5</h4>
    </div>
  </div>
</div>

<div class="row g-4">

  <div class="col-md-6">
    <div class="card shadow-sm p-3 position-relative">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">Monthly Sales</h6>
        <button class="btn btn-sm btn-outline-secondary"
          onclick="resetChart('salesChart')">↺ Reset</button>
      </div>
      <div id="salesChart" class="chart-box"></div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm p-3 position-relative">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">User Growth</h6>
        <button class="btn btn-sm btn-outline-secondary"
          onclick="resetChart('usersChart')">↺ Reset</button>
      </div>
      <div id="usersChart" class="chart-box"></div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm p-3 position-relative">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">Traffic Sources</h6>
        <button class="btn btn-sm btn-outline-secondary"
          onclick="resetChart('trafficChart')">↺ Reset</button>
      </div>
      <div id="trafficChart" class="chart-box"></div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm p-3 position-relative">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">Product Categories</h6>
        <button class="btn btn-sm btn-outline-secondary"
          onclick="resetChart('productsChart')">↺ Reset</button>
      </div>
      <div id="productsChart" class="chart-box"></div>
    </div>
  </div>

</div>
</div>

<script>
// BAR 1
fetch("/api/sales_monthly")
.then(r=>r.json())
.then(d=>Plotly.newPlot("salesChart", [{
  x:d.map(i=>i.month),
  y:d.map(i=>i.sales),
  type:"bar"
}], {}, {displayModeBar:false}));

// BAR 2
fetch("/api/user_growth")
.then(r=>r.json())
.then(d=>Plotly.newPlot("usersChart", [{
  x:d.map(i=>i.month),
  y:d.map(i=>i.users),
  type:"bar"
}], {}, {displayModeBar:false}));

// PIE 1
fetch("/api/traffic_sources")
.then(r=>r.json())
.then(d=>Plotly.newPlot("trafficChart", [{
  labels:d.map(i=>i.source),
  values:d.map(i=>i.percentage),
  type:"pie"
}], {}, {displayModeBar:false}));

// PIE 2
fetch("/api/product_categories")
.then(r=>r.json())
.then(d=>Plotly.newPlot("productsChart", [{
  labels:d.map(i=>i.category),
  values:d.map(i=>i.percentage),
  type:"pie"
}], {}, {displayModeBar:false}));
</script>

<script>
function resetChart(id){
  const gd = document.getElementById(id);
  Plotly.relayout(gd, {'xaxis.autorange':true, 'yaxis.autorange':true});
}
</script>

</body>
</html>
